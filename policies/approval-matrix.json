{
  "version": "1.0.0",
  "description": "Approval matrix for all 105 AlwaysClaw loops. Maps each loop to a risk tier and approval policy.",
  "riskTiers": {
    "safe": {
      "description": "Read-only or reversible operations with no external side effects.",
      "approvalPolicy": "none",
      "artifactLogging": true,
      "regressionCheck": false
    },
    "moderate": {
      "description": "Reversible writes or constrained external side effects.",
      "approvalPolicy": "pre-approved-policy-or-manual",
      "artifactLogging": true,
      "regressionCheck": true
    },
    "high": {
      "description": "Irreversible or privilege-elevating effects requiring explicit human approval.",
      "approvalPolicy": "explicit-manual-always",
      "artifactLogging": true,
      "regressionCheck": true,
      "dualCheckpoint": true,
      "checkpoints": [
        "before-execution",
        "after-verification-before-commit"
      ]
    }
  },
  "hardRestrictions": {
    "selfUpdatingLoops": {
      "constraint": "proposal-only",
      "description": "Self-updating loops may only produce signed proposals; they cannot self-apply changes."
    },
    "selfUpgradingLoops": {
      "constraint": "proposal-only",
      "description": "Self-upgrading loops may only produce upgrade proposals with rollback plans; execution requires explicit approval."
    },
    "tier2ToolsUnattended": {
      "constraint": "denied",
      "description": "Tier-2 (irreversible) tools cannot execute in unattended mode under any circumstances."
    },
    "browserPaymentMutation": {
      "constraint": "approval-required-always",
      "description": "Browser payment and account mutation actions always require explicit human approval."
    },
    "credentialChanges": {
      "constraint": "approval-plus-audit",
      "description": "Any credential changes require explicit approval and emit a mandatory audit event."
    }
  },
  "loopApprovals": {
    "ralph-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required when loop proposes policy or tool changes; read-only strategy analysis is pre-approved."
    },
    "research-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Read-only evidence gathering; no external side effects."
    },
    "discovery-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Read-only hypothesis generation from existing data."
    },
    "planning-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Produces prioritized plans and backlogs; no side effects."
    },
    "execution-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required when executing actions with external side effects."
    },
    "reflection-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Internal post-run critique; writes only to memory."
    },
    "meta-cognition-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Strategy analysis and self-critique; internal only."
    },
    "memory-consolidation-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Internal memory merge and deduplication."
    },
    "context-refresh-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Reloads context files from disk; no writes."
    },
    "heartbeat-synthesis-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Periodic health check synthesis; internal only."
    },
    "self-driven-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required for any task execution beyond proposal; proposals themselves are pre-approved."
    },
    "approval-gate-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Manages approval queue; does not execute approved actions itself."
    },
    "incident-response-loop-v1": {
      "riskTier": "high",
      "approvalRequired": true,
      "approvalCondition": "Always requires approval; containment actions are irreversible (kill switch, secret rotation)."
    },
    "skill-acquisition-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Learns from completed loops; writes to memory only."
    },
    "persona-calibration-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required when modifying persona files or identity parameters."
    },
    "queue-manager-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Internal queue admission and lane management."
    },
    "session-resolver-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Deterministic session key derivation; no side effects."
    },
    "cron-dispatcher-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Dispatches scheduled jobs from persistent store."
    },
    "heartbeat-monitor-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Monitors heartbeat freshness; read-only."
    },
    "presence-tracker-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Maintains ephemeral presence entries; internal only."
    },
    "route-resolver-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Deterministic route resolution; no side effects."
    },
    "event-dispatcher-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Internal event bus dispatch; no external effects."
    },
    "config-loader-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Reads configuration from disk; no writes."
    },
    "metrics-collector-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Collects and aggregates internal metrics."
    },
    "health-probing-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Read-only service health checks."
    },
    "watchdog-recovery-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required when recovery involves service restarts or state resets."
    },
    "restart-governor-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required; governs restart decisions with bounded retry policy."
    },
    "graceful-shutdown-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required; shutdown affects service availability."
    },
    "log-compaction-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Compacts and archives logs; reversible via backup."
    },
    "state-snapshot-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Creates point-in-time state snapshots; additive only."
    },
    "cache-invalidation-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Invalidates stale cache entries; self-healing."
    },
    "rate-limiter-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Enforces rate limits; internal policy enforcement."
    },
    "circuit-breaker-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Opens/closes circuit breakers based on failure thresholds."
    },
    "backpressure-handler-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Applies backpressure to overloaded queues; internal only."
    },
    "load-balancer-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Distributes work across available workers; internal routing."
    },
    "memory-write-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Writes memory entries to local store; reversible."
    },
    "memory-search-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Read-only semantic and keyword search over memory."
    },
    "memory-compact-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Compacts memory with summary preservation; reversible via snapshots."
    },
    "vector-index-refresh-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Rebuilds vector index from source memory files."
    },
    "context-compiler-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Assembles prompt context from persona and memory; no side effects."
    },
    "prompt-assembler-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Constructs final prompt payload; internal only."
    },
    "persona-loader-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Loads persona files (SOUL.md, IDENTITY.md, etc.) from disk."
    },
    "boot-ritual-executor-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required; boot ritual may execute initialization side effects."
    },
    "conversation-summarizer-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Produces conversation summaries; writes to memory only."
    },
    "adaptive-memory-decay-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Applies time-based relevance decay to memory entries."
    },
    "memory-conflict-resolver-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Resolves conflicting memory entries; internal merge logic."
    },
    "gmail-watch-renewal-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": false,
      "approvalCondition": "Pre-approved; renews Gmail watch subscription on schedule (daily cadence)."
    },
    "gmail-notification-intake-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Receives and validates Gmail push notifications; read-only intake."
    },
    "gmail-history-delta-sync-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Reads Gmail history delta from last known historyId."
    },
    "gmail-full-resync-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required; full resync is resource-intensive and resets baseline state."
    },
    "gmail-action-execution-loop-v1": {
      "riskTier": "high",
      "approvalRequired": true,
      "approvalCondition": "Always required; executes Gmail actions (send, delete, forward) which are irreversible."
    },
    "twilio-webhook-verification-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Validates X-Twilio-Signature on inbound webhooks; read-only security check."
    },
    "sms-inbound-processing-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Processes inbound SMS messages; normalizes and routes to session."
    },
    "sms-delivery-reconciliation-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Reconciles SMS delivery status callbacks; updates internal state."
    },
    "voice-call-orchestration-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required; initiating or managing voice calls has external communication effects."
    },
    "voice-callback-reconciliation-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Processes Twilio voice status callbacks; updates internal call state."
    },
    "browser-session-lifecycle-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required for session creation/teardown; manages isolated browser profiles."
    },
    "browser-workflow-executor-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required; executes browser actions (navigation, clicks, form fills) with potential side effects."
    },
    "browser-artifact-verification-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Verifies browser action outcomes via screenshots, DOM digests, and action logs."
    },
    "browser-prompt-injection-scanner-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Scans browser page content for prompt injection patterns; read-only analysis."
    },
    "voice-session-manager-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required; manages voice session lifecycle with external Twilio resources."
    },
    "stt-stream-processor-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Processes speech-to-text audio streams; internal transcription pipeline."
    },
    "tts-synthesis-dispatcher-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Dispatches text-to-speech synthesis requests; internal audio pipeline."
    },
    "voice-call-bridge-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required; bridges voice calls between Twilio and internal reasoning loops."
    },
    "voice-activity-detector-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Detects voice activity in audio streams; internal signal processing."
    },
    "auth-pairing-loop-v1": {
      "riskTier": "high",
      "approvalRequired": true,
      "approvalCondition": "Always required; establishes device/user trust relationships."
    },
    "auth-verification-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Verifies existing auth tokens and pairing state; read-only check."
    },
    "channel-gate-enforcer-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Enforces DM/group allowlists and mention-gating rules."
    },
    "tool-policy-enforcer-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Enforces tool tier policies per agent role; deny-by-default for tier-2."
    },
    "sandbox-policy-enforcer-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Enforces per-agent sandbox profiles (strict/normal/trusted)."
    },
    "secrets-scanner-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Scans outputs and logs for accidentally exposed secrets; read-only detection."
    },
    "secrets-rotator-loop-v1": {
      "riskTier": "high",
      "approvalRequired": true,
      "approvalCondition": "Always required; rotates secrets which is irreversible and affects all dependent integrations."
    },
    "incident-detector-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Detects anomalous patterns indicating security incidents; read-only analysis."
    },
    "incident-containment-loop-v1": {
      "riskTier": "high",
      "approvalRequired": true,
      "approvalCondition": "Always required; containment actions (kill switch, isolation) are irreversible."
    },
    "audit-trail-writer-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Appends immutable audit records; write-only, append-only."
    },
    "health-probing-reliability-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Probes service health endpoints; read-only checks."
    },
    "slo-burn-rate-alert-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Monitors SLO burn rate and emits alerts; internal metrics analysis."
    },
    "error-budget-tracker-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Tracks error budget consumption; read-only accounting."
    },
    "chaos-drill-runner-loop-v1": {
      "riskTier": "high",
      "approvalRequired": true,
      "approvalCondition": "Always required; injects failures into live systems for resilience testing."
    },
    "failover-orchestrator-loop-v1": {
      "riskTier": "high",
      "approvalRequired": true,
      "approvalCondition": "Always required; triggers failover which redirects traffic and may cause brief unavailability."
    },
    "dr-restore-validator-loop-v1": {
      "riskTier": "high",
      "approvalRequired": true,
      "approvalCondition": "Always required; disaster recovery restore modifies production state."
    },
    "deployment-canary-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required; canary deployments expose new code to subset of traffic."
    },
    "rollback-orchestrator-loop-v1": {
      "riskTier": "high",
      "approvalRequired": true,
      "approvalCondition": "Always required; rollbacks revert production state."
    },
    "capacity-planner-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Forecasts capacity needs from metrics; read-only analysis."
    },
    "latency-regression-detector-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Detects latency regressions from metrics; read-only analysis."
    },
    "queue-pressure-monitor-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Monitors queue depth and pressure; read-only metrics."
    },
    "cron-reliability-auditor-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Audits cron job execution reliability; read-only analysis."
    },
    "log-retention-enforcer-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Enforces log retention policies by archiving old logs; reversible."
    },
    "backup-integrity-checker-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Validates backup integrity via checksums; read-only verification."
    },
    "uptime-reporter-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Generates uptime reports from health data; read-only."
    },
    "test-runner-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Executes test suites in sandbox; no production side effects."
    },
    "config-drift-detector-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Compares running config against declared config; read-only diff."
    },
    "dependency-scanner-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Scans dependencies for known vulnerabilities; read-only analysis."
    },
    "code-quality-auditor-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Runs static analysis and quality checks; read-only."
    },
    "regression-validator-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Validates regression test results against baselines; read-only."
    },
    "proposal-reviewer-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Reviews incoming proposals for completeness; read-only analysis."
    },
    "approval-workflow-manager-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required; manages approval state transitions that gate execution of other loops."
    },
    "goal-rebalancer-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required when rebalancing affects priority of approved work items."
    },
    "policy-update-proposer-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required; policy change proposals must be reviewed before any application."
    },
    "architecture-drift-reviewer-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Reviews architecture drift against declared targets; read-only analysis."
    },
    "upgrade-proposal-generator-loop-v1": {
      "riskTier": "moderate",
      "approvalRequired": true,
      "approvalCondition": "Required; upgrade proposals must include rollback plan and pass review."
    },
    "self-modification-gatekeeper-loop-v1": {
      "riskTier": "high",
      "approvalRequired": true,
      "approvalCondition": "Always required; gates all self-modification attempts with immutable audit trail."
    },
    "audit-compliance-checker-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Checks audit trail completeness and compliance; read-only verification."
    },
    "stakeholder-report-generator-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Generates status reports from internal data; read-only."
    },
    "governance-dashboard-updater-loop-v1": {
      "riskTier": "safe",
      "approvalRequired": false,
      "approvalCondition": "Updates internal governance dashboard with latest metrics; internal only."
    }
  },
  "escalationPaths": {
    "safe": {
      "onFailure": "log-and-retry",
      "onRepeatedFailure": "escalate-to-meta-cognition-loop",
      "humanEscalation": false
    },
    "moderate": {
      "onFailure": "pause-and-log",
      "onRepeatedFailure": "escalate-to-incident-response",
      "humanEscalation": true,
      "humanEscalationChannel": "owner-dm"
    },
    "high": {
      "onFailure": "halt-and-contain",
      "onRepeatedFailure": "enter-safe-mode",
      "humanEscalation": true,
      "humanEscalationChannel": "owner-dm-plus-sms",
      "maxRetries": 1
    }
  }
}
