# AlwaysClaw Operations Runbook

Version: 1.0.0
Last updated: 2026-02-06
Owner: Operations Team

---

## 1. Boot and Recovery Sequence

The AlwaysClaw system runs on a hybrid runtime: core services in WSL2 (Ubuntu) and Windows sidecars for privileged host operations. The boot sequence must follow a strict dependency order to ensure all components start correctly.

### 1.1 Full Boot Sequence

**Step 1: Verify WSL2 Availability**

Before starting any services, confirm WSL2 is operational.

```powershell
# Check WSL2 is installed and Ubuntu is available
wsl --status
wsl -l -v

# Expected output: Ubuntu distro listed with VERSION 2
# If WSL2 is not running, start it:
wsl -d Ubuntu -- echo "WSL2 ready"
```

If WSL2 fails to start, see Troubleshooting section 6.1.

**Step 2: Start Core Services (in WSL2)**

Services must start in dependency order: gateway first, then downstream services.

```bash
# Inside WSL2
wsl -d Ubuntu -- bash -c "
  systemctl start alwaysclaw-gateway &&
  sleep 2 &&
  systemctl start alwaysclaw-loopd &&
  systemctl start alwaysclaw-tools &&
  systemctl start alwaysclaw-scheduler
"
```

Wait for each service to report healthy before proceeding. The gateway must be reachable before loopd, tools, or scheduler can register.

**Step 3: Start Sidecar Services**

Start Windows host sidecars that provide privileged operations.

```powershell
# Start the Windows host bridge
Start-Service AlwaysClawHostBridge

# Start the voice service (if voice is enabled)
wsl -d Ubuntu -- systemctl start alwaysclaw-voice
```

**Step 4: Run Health Checks**

Verify all components are healthy before declaring the system operational.

```powershell
# Run comprehensive health check
wsl -d Ubuntu -- curl -s http://localhost:3100/health | ConvertFrom-Json

# Check individual components
wsl -d Ubuntu -- curl -s http://localhost:3100/api/components/health
```

Expected: all components report `"status": "ok"`. If any component reports unhealthy, consult the troubleshooting guides below.

**Step 5: Heartbeat Registration**

Once all components are healthy, register the system heartbeat to signal operational readiness.

```bash
wsl -d Ubuntu -- curl -s -X POST http://localhost:3100/api/heartbeat/register
```

The heartbeat synthesis loop will take over from here, running every 30 minutes as defined in `ops/schedules.json`.

### 1.2 Automated Boot via Windows Task Scheduler

A Windows Task Scheduler task (`AlwaysClaw-Boot`) runs at logon and executes the full boot sequence. If the system was not shut down cleanly, the watchdog task (`AlwaysClaw-Watchdog`) runs every 5 minutes and will detect missing services and restart them.

### 1.3 Recovery from Unclean Shutdown

If the system was terminated unexpectedly:

1. Check for stale PID files: `wsl -d Ubuntu -- ls /var/run/alwaysclaw/`
2. Remove stale PID files if present
3. Check for incomplete loop checkpoints: `wsl -d Ubuntu -- curl -s http://localhost:3101/api/loops/stale-checkpoints`
4. Resume or discard stale checkpoints as appropriate
5. Run the full boot sequence (steps 1-5 above)
6. Verify no data corruption in state directory

---

## 2. Daily Operations

These tasks run automatically via the daily cadence in `ops/schedules.json` (cron: `0 8 * * *`). Operators should verify they completed successfully.

### 2.1 Log Compaction

The log-compaction loop (`log-compaction-loop-v1`) archives logs older than 7 days and compresses them.

Manual verification:
```bash
wsl -d Ubuntu -- ls -la /home/alwaysclaw/state/logs/archive/
wsl -d Ubuntu -- du -sh /home/alwaysclaw/state/logs/
```

If log directory exceeds 500MB, investigate retention policy or increase compaction frequency.

### 2.2 Memory Hygiene

The memory-hygiene tasks (`memory-compact-loop-v1` and `adaptive-memory-decay-loop-v1`) consolidate and prune memory entries.

Manual verification:
```bash
wsl -d Ubuntu -- curl -s http://localhost:3100/api/memory/stats
```

Check that `totalEntries` is within expected bounds and `lastCompactionAt` is within the last 24 hours.

### 2.3 Connector Health Verification

Verify all active integrations are healthy.

```bash
# Gmail
wsl -d Ubuntu -- curl -s http://localhost:3100/api/gmail/status
# Verify: watchActive=true, tokenValid=true, lastSyncAge < 30 minutes

# Twilio
wsl -d Ubuntu -- curl -s http://localhost:3100/api/twilio/status
# Verify: webhookEnabled=true, signatureValidation=true

# Browser
wsl -d Ubuntu -- curl -s http://localhost:3100/api/browser/status
# Verify: profileHealthy=true
```

### 2.4 SLO Dashboard Check

Review the daily SLO burn rate report generated by `slo-burn-rate-alert-loop-v1`.

```bash
wsl -d Ubuntu -- curl -s http://localhost:3100/api/slo/report/daily
```

Key metrics to verify:
- Command success rate >= 99.0%
- Median loop latency <= 30s
- Cron execution reliability >= 99.5%
- MTTR <= 5 minutes

If any SLO is approaching its burn rate threshold, investigate and address before the budget is exhausted. See `ops/slo-targets.json` for threshold details.

### 2.5 State Snapshot

The state-snapshot loop (`state-snapshot-loop-v1`) takes a daily snapshot of all critical state for backup purposes.

Manual verification:
```bash
wsl -d Ubuntu -- ls -la /home/alwaysclaw/state/snapshots/
# Verify: today's snapshot exists and file size is reasonable
```

---

## 3. Weekly Operations

These tasks run automatically on Mondays at 10:00 via the weekly cadence (`0 10 * * 1`).

### 3.1 Security Audit Execution

The security audit loops (`secrets-scanner-loop-v1` and `auth-verification-loop-v1`) scan for exposed secrets and verify authentication integrity.

Review audit results:
```bash
wsl -d Ubuntu -- curl -s http://localhost:3100/api/security/audit/latest
```

Action items from the audit should be triaged immediately:
- **Critical**: Exposed secrets or broken auth -- fix within 1 hour
- **Warning**: Weak configurations or expiring tokens -- fix within 24 hours
- **Info**: Best practice recommendations -- add to backlog

### 3.2 Backup Integrity Verification

The `backup-integrity-checker-loop-v1` verifies that backup snapshots can be restored.

```bash
wsl -d Ubuntu -- curl -s http://localhost:3100/api/backup/integrity/latest
```

Verify:
- Latest backup exists and is not corrupted
- Restore test completed successfully
- Backup age is within the last 24 hours

### 3.3 Dependency Updates Review

The `dependency-scanner-loop-v1` checks for known vulnerabilities in dependencies.

```bash
wsl -d Ubuntu -- curl -s http://localhost:3100/api/dependencies/scan/latest
```

Review any flagged vulnerabilities. Security-critical updates should be applied within 48 hours via the upgrade proposal workflow.

### 3.4 Chaos Drill

The `chaos-drill-runner-loop-v1` runs a controlled failure injection to verify resilience.

After the drill completes, review results:
```bash
wsl -d Ubuntu -- curl -s http://localhost:3100/api/chaos/drill/latest
```

Verify:
- System recovered within MTTR target (5 minutes)
- No data loss during recovery
- Degraded mode entered and exited correctly
- All SLOs maintained during the drill

### 3.5 Strategy Renewal

The `ralph-loop-v1` conducts a strategic review of system priorities and generates a 7-day action plan.

```bash
wsl -d Ubuntu -- curl -s http://localhost:3100/api/strategy/latest
```

Review the generated plan and approve or adjust priorities as needed.

---

## 4. Monthly Operations

These tasks run on the 1st of each month at 10:00 (`0 10 1 * *`).

### 4.1 Disaster Recovery Simulation

The `dr-restore-validator-loop-v1` performs a full DR simulation.

Procedure:
1. The loop creates a temporary restore environment
2. Restores the latest backup into the temporary environment
3. Runs health checks and data integrity verification against the restore
4. Compares restored state against live state
5. Tears down the temporary environment
6. Produces a DR readiness report

Review the report:
```bash
wsl -d Ubuntu -- curl -s http://localhost:3100/api/dr/validation/latest
```

If DR simulation fails, treat it as a P2 incident and resolve before the next monthly cycle.

### 4.2 Failover Test

Test the degraded mode entry and exit flow:
1. Simulate a critical component failure
2. Verify degraded mode activates correctly
3. Verify tier-2 tools are disabled
4. Verify read-only and communication channels remain active
5. Simulate recovery and verify re-elevation works
6. Document results

### 4.3 Capacity Review

The `capacity-planner-loop-v1` analyzes resource usage trends.

```bash
wsl -d Ubuntu -- curl -s http://localhost:3100/api/capacity/report/latest
```

Review:
- Disk usage trends (state directory, logs, snapshots)
- Memory usage trends
- API rate limit utilization (Gmail, Twilio)
- Token consumption trends

If any resource is projected to exhaust within 30 days, take action.

### 4.4 Governance Dashboard Update

The `governance-dashboard-updater-loop-v1` refreshes the governance dashboard with current metrics.

```bash
wsl -d Ubuntu -- curl -s http://localhost:3100/api/governance/dashboard
```

Review: loop execution compliance, approval matrix adherence, policy drift indicators.

---

## 5. Emergency Procedures Quick Reference

| Emergency | First Action | Kill Switch | Recovery |
|-----------|-------------|-------------|----------|
| Full system down | Check WSL2 status | N/A | Full boot sequence (sec 1.1) |
| Gateway unresponsive | Check gateway logs | Restart gateway | `systemctl restart alwaysclaw-gateway` |
| Gmail compromise | Gmail kill switch | Stop watch + revoke token | Re-authenticate + re-create watch |
| Twilio compromise | Twilio kill switch | Disable webhook | Rotate API keys + re-enable |
| Browser hijack | Browser kill switch | Close all profiles | Clear cookies + restart |
| Voice leak | Voice kill switch | Terminate streams | Restart voice service |
| Credential exposed | Rotate immediately | Per-credential kill switch | See incident-runbook.md sec 3 |
| Disk space critical | Clear log archives | Automatic degraded mode | Compact + archive old state |
| Memory exhaustion | Restart affected service | Automatic degraded mode | Investigate memory leak |
| Loop stuck | Cancel stuck loop | N/A | `POST /api/loops/{id}/cancel` |
| Cron jobs not running | Check scheduler health | N/A | `systemctl restart alwaysclaw-scheduler` |

---

## 6. Troubleshooting Guides

### 6.1 WSL2 Will Not Start

Symptoms: `wsl -l --running` returns empty or errors.

Steps:
1. Check Windows features: `dism.exe /online /get-featureinfo /featurename:Microsoft-Windows-Subsystem-Linux`
2. Verify Virtual Machine Platform is enabled: `dism.exe /online /get-featureinfo /featurename:VirtualMachinePlatform`
3. If features are disabled, enable them and reboot:
   ```powershell
   dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
   dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
   ```
4. If features are enabled but WSL2 still fails:
   - Run `wsl --update` to update the WSL2 kernel
   - Run `wsl --shutdown` then retry
   - Check Event Viewer for Hyper-V errors
5. If the Ubuntu distro is corrupted:
   - Export any recoverable state first
   - Unregister and reinstall: `wsl --unregister Ubuntu && wsl --install -d Ubuntu`
   - Restore state from the latest backup snapshot

### 6.2 Gateway Unresponsive

Symptoms: `curl http://localhost:3100/health` times out or returns an error.

Steps:
1. Check if the process is running: `wsl -d Ubuntu -- systemctl status alwaysclaw-gateway`
2. Check gateway logs: `wsl -d Ubuntu -- journalctl -u alwaysclaw-gateway --since "10 minutes ago"`
3. Check port availability: `wsl -d Ubuntu -- ss -tlnp | grep 3100`
4. If port is in use by another process, kill it and restart
5. If OOM killed: check `dmesg` for OOM messages, increase memory limits in `.wslconfig`
6. If config is corrupted: restore `alwaysclaw.json` from latest snapshot and restart

### 6.3 Loop Stuck in Preflight

Symptoms: Loop status shows `preflight` for more than 5 minutes.

Steps:
1. Check loop state: `wsl -d Ubuntu -- curl -s http://localhost:3101/api/loops/{loopId}/state`
2. Check if entry criteria are satisfied
3. Check if required context files are accessible
4. Check if a dependency loop is blocked or failed
5. If stuck due to a missing resource: provide the resource or skip the preflight check
6. Force cancel if unrecoverable: `wsl -d Ubuntu -- curl -s -X POST http://localhost:3101/api/loops/{loopId}/cancel`
7. The loop will retry at its next scheduled cadence

### 6.4 Memory Compaction Failure

Symptoms: Memory stats show `lastCompactionAt` is stale, or memory entries growing unbounded.

Steps:
1. Check compaction loop status: `wsl -d Ubuntu -- curl -s http://localhost:3101/api/loops/memory-compact-loop-v1/state`
2. Check disk space on state partition: `wsl -d Ubuntu -- df -h /home/alwaysclaw/state/`
3. If disk is full: run emergency log compaction first
4. Check for corrupted memory files: `wsl -d Ubuntu -- alwaysclaw memory validate`
5. If corruption found: restore memory from the latest state snapshot
6. Manually trigger compaction: `wsl -d Ubuntu -- curl -s -X POST http://localhost:3101/api/loops/memory-compact-loop-v1/trigger`

### 6.5 Gmail Watch Expired

Symptoms: Gmail status shows `watchActive: false` or `watchExpiration` is in the past.

Steps:
1. Check Gmail status: `wsl -d Ubuntu -- curl -s http://localhost:3100/api/gmail/status`
2. Verify OAuth token is still valid: check `tokenValid` field
3. If token expired: re-authenticate (see Secret Rotation in incident-runbook.md)
4. If token valid but watch expired: re-create watch:
   ```bash
   wsl -d Ubuntu -- curl -s -X POST http://localhost:3100/api/gmail/watch/start
   ```
5. Verify watch is active and run a manual history sync to catch up on missed messages:
   ```bash
   wsl -d Ubuntu -- curl -s -X POST http://localhost:3100/api/gmail/sync/full
   ```
6. If `history.list` returns 404: the historyId is stale, and the full sync (step 5) will reset the baseline

### 6.6 Twilio Webhook Failures

Symptoms: Inbound SMS or voice calls are not being processed.

Steps:
1. Check Twilio status: `wsl -d Ubuntu -- curl -s http://localhost:3100/api/twilio/status`
2. Verify webhook URL is reachable from the internet (check tunnel/ngrok/reverse proxy)
3. Check signature validation: ensure the auth token in config matches the Twilio account
4. Review Twilio Console debugger for failed webhook deliveries
5. Check for lowercase header variant: WebSocket handshakes use `x-twilio-signature` (lowercase)
6. If webhook URL changed: update it in Twilio Console
7. Test with a manual webhook: `wsl -d Ubuntu -- curl -s -X POST http://localhost:3100/api/twilio/test-webhook`

---

## 7. Configuration File Reference

| File | Purpose | Location |
|------|---------|----------|
| `ops/schedules.json` | 24/7 operations schedule with all cadence tiers | Worktree: `ops/` |
| `ops/slo-targets.json` | SLO definitions and error budget policy | Worktree: `ops/` |
| `ops/watchdog-policy.json` | Liveness checks, restart strategy, circuit breaker | Worktree: `ops/` |
| `ops/degraded-mode-policy.json` | Degraded mode triggers, behavior, re-elevation | Worktree: `ops/` |
| `ops/incident-runbook.md` | Incident response procedures | Worktree: `ops/` |
| `alwaysclaw.json` | Main system configuration | `C:\AlwaysClaw\state\config\` |
| `jobs.json` | Persistent cron job definitions | `C:\AlwaysClaw\state\cron\` |

---

## 8. Operational Contacts and Escalation

- **Primary operator**: System owner (configured in `USER.md`)
- **Heartbeat channel**: Receives all automated health notifications
- **Incident channel**: Receives P1/P2 incident notifications
- **Escalation**: If automated recovery fails after 3 attempts, operator is notified with full forensics package

---

## 9. Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2026-02-06 | Initial runbook covering boot, daily/weekly/monthly ops, troubleshooting, and emergency procedures |
