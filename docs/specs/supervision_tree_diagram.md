# Process Supervision Tree - Visual Diagram
## Windows 10 OpenClaw AI Agent System

```
╔══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    SYSTEM SUPERVISOR (Root)                                          ║
║  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐  ║
║  │  • System lifecycle management                                                                 │  ║
║  │  • Global configuration                                                                        │  ║
║  │  • Shutdown coordination                                                                       │  ║
║  │  • Signal handling                                                                             │  ║
║  │  Strategy: One-for-One | Max Restarts: 10/60s                                                  │  ║
║  └────────────────────────────────────────────────────────────────────────────────────────────────┘  ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════╝
                                          │
            ┌─────────────────────────────┼─────────────────────────────┐
            │                             │                             │
            ▼                             ▼                             ▼
╔═══════════════════════╗   ╔═══════════════════════╗   ╔═══════════════════════╗
║   CORE SUPERVISOR     │   ║   AGENT SUPERVISOR    │   ║  SERVICE SUPERVISOR   ║
║   (One-for-One)       │   ║   (Rest-for-One)      │   ║   (One-for-All)       ║
║                       │   ║                       │   ║                       ║
║ ┌─────────────────┐   │   │ ┌─────────────────┐   │   │ ┌─────────────────┐   ║
║ │ Config Manager  │   │   │ │ Agent Loop 1    │───┼───┤ │ Gmail Service   │   ║
║ │ [PERMANENT]     │   │   │ │ [TRANSIENT]     │   │   │ │ [PERMANENT]     │   ║
║ └─────────────────┘   │   │ └─────────────────┘   │   │ └─────────────────┘   ║
║ ┌─────────────────┐   │   │ ┌─────────────────┐   │   │ ┌─────────────────┐   ║
║ │ Identity Mgr    │   │   │ │ Agent Loop 2    │   │   │ │ Browser Service │   ║
║ │ [PERMANENT]     │   │   │ │ [TRANSIENT]     │   │   │ │ [PERMANENT]     │   ║
║ └─────────────────┘   │   │ └─────────────────┘   │   │ └─────────────────┘   ║
║ ┌─────────────────┐   │   │ ┌─────────────────┐   │   │ ┌─────────────────┐   ║
║ │ User Manager    │   │   │ │ Agent Loop 3    │   │   │ │ TTS Service     │   ║
║ │ [PERMANENT]     │   │   │ │ [TRANSIENT]     │   │   │ │ [PERMANENT]     │   ║
║ └─────────────────┘   │   │ └─────────────────┘   │   │ └─────────────────┘   ║
║ ┌─────────────────┐   │   │ ┌─────────────────┐   │   │ ┌─────────────────┐   ║
║ │ Soul Manager    │   │   │ │ ... (to 15)     │   │   │ │ STT Service     │   ║
║ │ [PERMANENT]     │   │   │ │ [TRANSIENT]     │   │   │ │ [PERMANENT]     │   ║
║ └─────────────────┘   │   │ └─────────────────┘   │   │ └─────────────────┘   ║
║ ┌─────────────────┐   │   │ ┌─────────────────┐   │   │ ┌─────────────────┐   ║
║ │ Heartbeat Mgr   │   │   │ │ Cron Scheduler  │   │   │ │ Twilio Service  │   ║
║ │ [PERMANENT]     │   │   │ │ [PERMANENT]     │   │   │ │ [PERMANENT]     │   ║
║ └─────────────────┘   │   │ └─────────────────┘   │   │ └─────────────────┘   ║
║                       │   │ ┌─────────────────┐   │   │                       ║
║ Max Restarts: 5/60s   │   │ │ State Manager   │   │   │ Max Restarts: 5/60s   ║
║                       │   │ │ [PERMANENT]     │   │   │                       ║
╚═══════════════════════╝   │ └─────────────────┘   │   ╚═══════════════════════╝
                            │                       │
                            │ Max Restarts: 3/60s   │
                            ╚═══════════════════════╝
```

## Worker Pool Hierarchy

```
╔══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    WORKER POOL MANAGER                                               ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════╝
                                          │
        ┌─────────────────────────────────┼─────────────────────────────────┐
        │                                 │                                 │
        ▼                                 ▼                                 ▼
╔═══════════════════════╗   ╔═══════════════════════╗   ╔═══════════════════════╗
║   PREFORK POOL        │   ║   THREAD POOL         │   ║   ASYNC POOL          ║
║   (CPU-Bound)         │   ║   (I/O-Bound)         │   ║   (I/O-Bound)         ║
║                       │   ║                       │   ║                       ║
║ ┌─────────────────┐   │   ║ ┌─────────────────┐   │   ║ ┌─────────────────┐   ║
║ │ Worker 1        │   │   ║ │ Thread 1        │   │   ║ │ Async Task 1    │   ║
║ │ [PID: 1234]     │   │   ║ │ [TID: 1001]     │   │   ║ │ [CORO: A001]    │   ║
║ │ CPU: 15%        │   │   ║ │ CPU: 2%         │   │   ║ │ CPU: 1%         │   ║
║ │ MEM: 512MB      │   │   ║ │ MEM: 50MB       │   │   ║ │ MEM: 10MB       │   ║
║ └─────────────────┘   │   ║ └─────────────────┘   │   ║ └─────────────────┘   ║
║ ┌─────────────────┐   │   ║ ┌─────────────────┐   │   ║ ┌─────────────────┘   ║
║ │ Worker 2        │   │   ║ │ Thread 2        │   │   ║ │ Async Task 2    │   ║
║ │ [PID: 1235]     │   │   ║ │ [TID: 1002]     │   │   ║ │ [CORO: A002]    │   ║
║ │ CPU: 12%        │   │   ║ │ CPU: 3%         │   │   ║ │ CPU: 1%         │   ║
║ │ MEM: 480MB      │   │   ║ │ MEM: 45MB       │   │   ║ │ MEM: 12MB       │   ║
║ └─────────────────┘   │   ║ └─────────────────┘   │   ║ └─────────────────┘   ║
║ ┌─────────────────┐   │   ║ ┌─────────────────┐   │   ║ ┌─────────────────┐   ║
║ │ Worker 3        │   │   ║ │ Thread 3        │   │   ║ │ Async Task 3    │   ║
║ │ [PID: 1236]     │   │   ║ │ [TID: 1003]     │   │   ║ │ [CORO: A003]    │   ║
║ │ CPU: 18%        │   │   ║ │ CPU: 1%         │   │   ║ │ CPU: 2%         │   ║
║ │ MEM: 520MB      │   │   ║ │ MEM: 40MB       │   │   ║ │ MEM: 15MB       │   ║
║ └─────────────────┘   │   ║ └─────────────────┘   │   ║ └─────────────────┘   ║
║ ┌─────────────────┐   │   ║ ┌─────────────────┐   │   ║ ┌─────────────────┐   ║
║ │ Worker 4        │   │   ║ │ ... (to 50)     │   │   ║ │ ... (to 1000)   │   ║
║ │ [PID: 1237]     │   │   ║ │                 │   │   ║ │                 │   ║
║ │ CPU: 10%        │   │   ║ │                 │   │   ║ │                 │   ║
║ │ MEM: 450MB      │   │   ║ │                 │   │   ║ │                 │   ║
║ └─────────────────┘   │   ║ └─────────────────┘   │   ║ └─────────────────┘   ║
║                       │   ║                       │   ║                       ║
║ Min: 2 | Max: 8       │   ║ Min: 5 | Max: 50      │   ║ Max: 1000             ║
║ Max Tasks/Child: 1000 │   ║                       │   ║                       ║
╚═══════════════════════╝   ╚═══════════════════════╝   ╚═══════════════════════╝
```

## Inter-Process Communication Architecture

```
╔══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    IPC LAYER ARCHITECTURE                                            ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════╝
                                          │
        ┌─────────────────────────────────┼─────────────────────────────────┐
        │                                 │                                 │
        ▼                                 ▼                                 ▼
╔═══════════════════════╗   ╔═══════════════════════╗   ╔═══════════════════════╗
║   NAMED PIPES         │   ║   MESSAGE QUEUES      │   ║   SHARED MEMORY       ║
║   (Windows Primary)   │   ║   (Cross-Platform)    │   ║   (Large Data)        ║
║                       │   ║                       │   ║                       ║
║ ┌─────────────────┐   │   ║ ┌─────────────────┐   │   ║ ┌─────────────────┐   ║
║ │ \\.\pipe\openclaw│   │   ║ │ multiprocessing │   │   ║ │ multiprocessing │   ║
║ │ _cmd           │   │   ║ │ .Queue()        │   │   ║ │ .SharedMemory   │   ║
║ │                 │   │   ║ │                 │   │   ║ │                 │   ║
║ │ Commands:       │   │   ║ │ Priority:       │   │   ║ │ Buffers:        │   ║
║ │ - START         │   │   ║ │ - HIGH          │   │   ║ │ - Audio Data    │   ║
║ │ - STOP          │   │   ║ │ - NORMAL        │   │   ║ │ - Image Data    │   ║
║ │ - RESTART       │   │   ║ │ - LOW           │   │   ║ │ - Model Cache   │   ║
║ │ - STATUS        │   │   ║ │                 │   │   ║ │                 │   ║
║ └─────────────────┘   │   ║ └─────────────────┘   │   ║ └─────────────────┘   ║
║ ┌─────────────────┐   │   ║ ┌─────────────────┐   │   ║ ┌─────────────────┐   ║
║ │ \\.\pipe\openclaw│   │   ║ │ asyncio.Queue() │   │   ║ │ mmap            │   ║
║ │ _events        │   │   ║ │                 │   │   ║ │                 │   ║
║ │                 │   │   ║ │ Async:          │   │   ║ │ File-backed:    │   ║
║ │ Events:         │   │   ║ │ - Non-blocking  │   │   ║ │ - Persistent    │   ║
║ │ - heartbeat     │   │   ║ │ - High throughput│   │   ║ │ - Large capacity│   ║
║ │ - state_change  │   │   ║ │ - Coroutine-safe│   │   ║ │                 │   ║
║ │ - error         │   │   │                 │   │   ║ └─────────────────┘   ║
║ └─────────────────┘   │   ║ └─────────────────┘   │   ╚═══════════════════════╝
║ ┌─────────────────┐   │   ╚═══════════════════════╝
║ │ \\.\pipe\openclaw│   │
║ │ _data          │   │
║ │                 │   │
║ │ Data Streams:   │   │
║ │ - audio_in      │   │
║ │ - audio_out     │   │
║ │ - screen_cap    │   │
║ └─────────────────┘   │
╚═══════════════════════╝
```

## Heartbeat and Monitoring System

```
╔══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    HEARTBEAT SYSTEM FLOW                                             ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════╝

    ┌──────────────┐         ┌──────────────┐         ┌──────────────┐         ┌──────────────┐
    │   Worker 1   │         │   Worker 2   │         │   Worker N   │         │   Monitor    │
    │  (Agent)     │         │  (Service)   │         │  (Loop)      │         │  (Central)   │
    └──────┬───────┘         └──────┬───────┘         └──────┬───────┘         └──────┬───────┘
           │                        │                        │                        │
           │  Heartbeat (10s)       │  Heartbeat (10s)       │  Heartbeat (10s)       │
           │  ┌────────────────┐    │  ┌────────────────┐    │  ┌────────────────┐    │
           │  │ process_id     │    │  │ process_id     │    │  │ process_id     │    │
           │  │ cpu_percent    │───▶│  │ cpu_percent    │───▶│  │ cpu_percent    │───▶│
           │  │ memory_percent │    │  │ memory_percent │    │  │ memory_percent │    │
           │  │ status         │    │  │ status         │    │  │ status         │    │
           │  └────────────────┘    │  └────────────────┘    │  └────────────────┘    │
           │                        │                        │                        │
           │                        │                        │                        │
           │                        │                        │                        ▼
           │                        │                        │              ┌──────────────────┐
           │                        │                        │              │  Health Check    │
           │                        │                        │              │  (Every 5s)      │
           │                        │                        │              └────────┬─────────┘
           │                        │                        │                       │
           │                        │                        │                       ▼
           │                        │                        │              ┌──────────────────┐
           │                        │                        │              │  Timeout > 30s?  │
           │                        │                        │              └────────┬─────────┘
           │                        │                        │                       │
           │                        │                        │              ┌────────┴─────────┐
           │                        │                        │              │  YES             │  NO
           │                        │                        │              ▼                  ▼
           │                        │                        │      ┌──────────────┐   ┌──────────────┐
           │                        │                        │      │  Mark Failed │   │  Update Status│
           │                        │                        │      └──────┬───────┘   └──────────────┘
           │                        │                        │             │
           │                        │                        │             ▼
           │                        │                        │      ┌──────────────┐
           │                        │                        │      │  Trigger     │
           │                        │                        │      │  Restart     │
           │                        │                        │      └──────────────┘
           │                        │                        │
           ▼                        ▼                        ▼
    ┌──────────────┐         ┌──────────────┐         ┌──────────────┐
    │  Time-Series │         │   Metrics    │         │   Dashboard  │
    │   Database   │         │  Aggregation │         │   (Web UI)   │
    └──────────────┘         └──────────────┘         └──────────────┘
```

## Crash Recovery Flow

```
╔══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    CRASH RECOVERY FLOW                                               ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════╝

    ┌─────────────────────────────────────────────────────────────────────────────────────────────┐
    │                                    DETECTION                                                  │
    │  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐              │
    │  │ Heartbeat    │ or │ Process Exit │ or │ Health Check │ or │ Log Error    │              │
    │  │ Timeout      │    │ Code != 0    │    │ Failed       │    │ Detected     │              │
    │  └──────┬───────┘    └──────┬───────┘    └──────┬───────┘    └──────┬───────┘              │
    │         └────────────────────┴───────────────────┴───────────────────┘                      │
    │                              │                                                              │
    └──────────────────────────────┼──────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
    ┌─────────────────────────────────────────────────────────────────────────────────────────────┐
    │                                  ANALYSIS                                                   │
    │  ┌─────────────────────────────────────────────────────────────────────────────────────┐   │
    │  │  1. Identify failed process                                                         │   │
    │  │  2. Check restart policy (PERMANENT/TRANSIENT/TEMPORARY)                            │   │
    │  │  3. Count recent restarts (within time window)                                      │   │
    │  │  4. Calculate backoff delay (exponential)                                           │   │
    │  └─────────────────────────────────────────────────────────────────────────────────────┘   │
    │                                            │                                               │
    │                              ┌─────────────┴─────────────┐                                 │
    │                              │                           │                                 │
    │                         Max Restarts                 Under Limit                            │
    │                         Exceeded?                                                      │
    │                              │                           │                                 │
    │                    ┌─────────┘                           └─────────┐                       │
    │                    ▼                                               ▼                       │
    │           ┌──────────────┐                               ┌──────────────┐                  │
    │           │  GIVE UP     │                               │  RESTART     │                  │
    │           │  Escalate to │                               │  Proceed     │                  │
    │           │  parent      │                               │  with restart│                  │
    │           └──────────────┘                               └──────┬───────┘                  │
    │                                                                 │                          │
    └─────────────────────────────────────────────────────────────────┼──────────────────────────┘
                                                                      │
                                                                      ▼
    ┌─────────────────────────────────────────────────────────────────────────────────────────────┐
    │                                  RESTART EXECUTION                                          │
    │                                                                                             │
    │  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐  │
    │  │ 1. Wait Backoff │───▶│ 2. Terminate    │───▶│ 3. Clean State  │───▶│ 4. Start New    │  │
    │  │    (2^n sec)    │    │    Old Process  │    │    (if needed)  │    │    Process      │  │
    │  └─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘  │
    │                                                                                             │
    │  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐                         │
    │  │ 5. Verify Start │───▶│ 6. Register for │───▶│ 7. Resume Work  │                         │
    │  │    (health chk) │    │    Monitoring   │    │                 │                         │
    │  └─────────────────┘    └─────────────────┘    └─────────────────┘                         │
    │                                                                                             │
    └─────────────────────────────────────────────────────────────────────────────────────────────┘


    RESTART BACKOFF TABLE:
    ┌────────────────┬─────────────┐
    │ Restart Count  │ Delay (sec) │
    ├────────────────┼─────────────┤
    │ 1              │ 2           │
    │ 2              │ 4           │
    │ 3              │ 8           │
    │ 4              │ 16          │
    │ 5              │ 32          │
    │ 6+             │ 60 (max)    │
    └────────────────┴─────────────┘
```

## Graceful Shutdown Sequence

```
╔══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    GRACEFUL SHUTDOWN SEQUENCE                                        ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════╝

    TRIGGER: SIGINT / SIGTERM / CTRL+C / Shutdown Request
                              │
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────────────────────────┐
    │  1. SET SHUTDOWN EVENT                                                                      │
    │     • Set global shutdown flag                                                              │
    │     • Log shutdown initiation                                                               │
    │     • Notify all components                                                                 │
    └─────────────────────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────────────────────────┐
    │  2. STOP ACCEPTING NEW WORK                                                                 │
    │     • Close task queues (reject new submissions)                                            │
    │     • Close listening sockets/ports                                                         │
    │     • Notify load balancer (if applicable)                                                  │
    │     • Set status to "shutting_down"                                                         │
    └─────────────────────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────────────────────────┐
    │  3. DRAIN IN-PROGRESS WORK                                                                  │
    │     • Wait for active tasks to complete (timeout: 30s)                                      │
    │     • Cancel long-running tasks gracefully                                                  │
    │     • Save checkpoint/state if needed                                                       │
    │     • Progress: [████████░░] 80%                                                            │
    └─────────────────────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────────────────────────┐
    │  4. STOP WORKER POOLS (Priority Order)                                                      │
    │                                                                                             │
    │     Priority 0: Async Pool      ─────┐                                                      │
    │     Priority 1: Thread Pool     ─────┼──▶ Send SIGTERM                                      │
    │     Priority 2: Prefork Pool    ─────┘    Wait 5s                                           │
    │                                           SIGKILL if needed                                 │
    └─────────────────────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────────────────────────┐
    │  5. STOP SUPERVISORS (Bottom-Up)                                                            │
    │                                                                                             │
    │     Level 3: Service Supervisor    ─────┐                                                   │
    │     Level 2: Agent Supervisor      ─────┼──▶ Stop children in reverse order                │
    │     Level 1: Core Supervisor       ─────┘    Wait for graceful exit                         │
    │     Level 0: System Supervisor     ───────── Final cleanup                                  │
    └─────────────────────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────────────────────────┐
    │  6. FINAL CLEANUP                                                                           │
    │     • Close all IPC channels (pipes, queues, sockets)                                       │
    │     • Release shared memory                                                                 │
    │     • Flush and close log files                                                             │
    │     • Save final state to disk                                                              │
    │     • Close database connections                                                            │
    │     • Release Windows Job Object                                                            │
    └─────────────────────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
    ┌─────────────────────────────────────────────────────────────────────────────────────────────┐
    │  7. EXIT                                                                                    │
    │     • Log "Shutdown complete"                                                               │
    │     • Exit with code 0 (success)                                                            │
    │     • Force exit after 5s safety timeout                                                    │
    └─────────────────────────────────────────────────────────────────────────────────────────────┘

    TIMEOUTS:
    ┌────────────────────────┬────────────┐
    │ Phase                  │ Timeout    │
    ├────────────────────────┼────────────┤
    │ Task Drain             │ 30 seconds │
    │ Worker Pool Stop       │ 10 seconds │
    │ Supervisor Stop        │ 10 seconds │
    │ Final Cleanup          │ 10 seconds │
    │ Total Shutdown         │ 60 seconds │
    │ Force Exit             │ 5 seconds  │
    └────────────────────────┴────────────┘
```

## Process Isolation with Windows Job Objects

```
╔══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    WINDOWS JOB OBJECT ISOLATION                                      ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════╝

    ┌─────────────────────────────────────────────────────────────────────────────────────────────┐
    │                              OPENCLAW JOB OBJECT                                            │
    │  ┌─────────────────────────────────────────────────────────────────────────────────────┐   │
    │  │  Job Name: OpenClawJob_<PID>                                                        │   │
    │  │                                                                                     │   │
    │  │  LIMITS:                                                                            │   │
    │  │  ┌─────────────────────────────────────────────────────────────────────────────┐   │   │
    │  │  │ • Max Active Processes: 100                                                 │   │   │
    │  │  │ • Per-Process Memory Limit: 2 GB                                            │   │   │
    │  │  │ • Total Job Memory Limit: 8 GB                                              │   │   │
    │  │  │ • CPU Rate Limit: 80%                                                       │   │   │
    │  │  │ • Priority Class: NORMAL_PRIORITY_CLASS                                     │   │   │
    │  │  │ • Kill on Job Close: ENABLED                                                │   │   │
    │  │  └─────────────────────────────────────────────────────────────────────────────┘   │   │
    │  │                                                                                     │   │
    │  │  FLAGS:                                                                             │   │
    │  │  JOB_OBJECT_LIMIT_PROCESS_MEMORY | JOB_OBJECT_LIMIT_JOB_MEMORY |                   │   │
    │  │  JOB_OBJECT_LIMIT_ACTIVE_PROCESS | JOB_OBJECT_LIMIT_PRIORITY_CLASS |               │   │
    │  │  JOB_OBJECT_LIMIT_KILL_ON_JOB_CLOSE | JOB_OBJECT_LIMIT_CPU_RATE                    │   │
    │  └─────────────────────────────────────────────────────────────────────────────────────┘   │
    │                                            │                                                │
    │                                            │ AssignProcessToJobObject()                     │
    │                                            ▼                                                │
    │  ┌─────────────────────────────────────────────────────────────────────────────────────┐   │
    │  │                              PROCESS TREE                                           │   │
    │  │                                                                                     │   │
    │  │   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │   │
    │  │   │ System       │  │ Agent Loop 1 │  │ Agent Loop 2 │  │ Service      │          │   │
    │  │   │ Supervisor   │  │ [PID: 1001]  │  │ [PID: 1002]  │  │ Worker       │          │   │
    │  │   │ [PID: 1000]  │  │ MEM: 512MB   │  │ MEM: 480MB   │  │ [PID: 1003]  │          │   │
    │  │   │ MEM: 128MB   │  │ CPU: 15%     │  │ CPU: 12%     │  │ MEM: 256MB   │          │   │
    │  │   └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘          │   │
    │  │                                                                                     │   │
    │  │   All child processes automatically inherit job membership                          │   │
    │  │   If parent dies, all children are terminated (KILL_ON_JOB_CLOSE)                   │   │
    │  └─────────────────────────────────────────────────────────────────────────────────────┘   │
    └─────────────────────────────────────────────────────────────────────────────────────────────┘

    ENFORCEMENT:
    ┌────────────────────────┬────────────────────────────────────────────────────────────────┐
    │ Limit                  │ Action When Exceeded                                           │
    ├────────────────────────┼────────────────────────────────────────────────────────────────┤
    │ Max Processes          │ CreateProcess() fails with ERROR_NOT_ENOUGH_QUOTA             │
    │ Per-Process Memory     │ Allocation fails or process terminated                         │
    │ Total Job Memory       │ New allocations fail                                           │
    │ CPU Rate               │ Process throttled to limit                                     │
    │ Job Handle Closed      │ All processes terminated immediately                           │
    └────────────────────────┴────────────────────────────────────────────────────────────────┘
```

## Resource Allocation Summary

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    RESOURCE ALLOCATION SUMMARY                                      │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                     │
│  CPU CORES (Example: 8-core system)                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │ Core 0: [SYSTEM]  Critical services, heartbeat, monitoring                                  │   │
│  │ Cores 1-3: [AGENTS] Agent loops (16 loops, distributed)                                     │   │
│  │ Cores 4-6: [WORKERS] Prefork worker pool for CPU tasks                                      │   │
│  │ Core 7: [SERVICES] I/O services (Gmail, Browser, TTS, STT, Twilio)                          │   │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                     │
│  MEMORY ALLOCATION                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │ System Supervisor:     512 MB                                                               │   │
│  │ Core Services:       1,024 MB (4 services x 256 MB)                                         │   │
│  │ Agent Loops:        16,384 MB (16 loops x 1,024 MB)                                         │   │
│  │ Worker Pools:        8,192 MB (4 workers x 2,048 MB)                                        │   │
│  │ Services:            2,560 MB (5 services x 512 MB)                                         │   │
│  │ ─────────────────────────────────────────────                                               │   │
│  │ TOTAL:              ~28 GB (recommend 32 GB system)                                         │   │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                     │
│  PROCESS LIMITS                                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │ Max Total Processes:        100 (Job Object limit)                                          │   │
│  │ Max Agent Loops:             15 (hardcoded)                                                 │   │
│  │ Max Worker Processes:        50 (prefork pool max)                                          │   │
│  │ Max Thread Workers:         100 (thread pool max)                                           │   │
│  │ Max Async Concurrency:    1,000 (semaphore limit)                                           │   │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                     │
│  HANDLE LIMITS (Windows)                                                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐   │
│  │ System Processes:        1,000 handles                                                      │   │
│  │ Agent Loops:             5,000 handles each                                                 │   │
│  │ Service Workers:         5,000 handles each                                                 │   │
│  │ I/O Workers:            10,000 handles each                                                 │   │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
```
