# OpenClaw Agent Service - Multi-stage Docker Build
# Node.js + Python runtime for AI agent operations

# Stage 1: Build
FROM node:18-slim AS build
WORKDIR /app
COPY package*.json ./
RUN npm ci --production
COPY . .

# Stage 2: Runtime
FROM node:18-slim
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        python3 \
        python3-pip \
        curl \
    && rm -rf /var/lib/apt/lists/*
WORKDIR /app
COPY --from=build /app .
RUN pip3 install --no-cache-dir --break-system-packages -r requirements.txt
EXPOSE 8080
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:8080/health || exit 1
ENTRYPOINT ["node", "service.js"]
